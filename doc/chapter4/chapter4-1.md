# Chapter4-1: ルーティング

## ルーティング(Rooting)

### ルーティング is 何？

[Chapter2の3](https://github.com/igadaruma/study-scala/blob/main/doc/chapter2/chapter2.md#3-%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E3%81%A8url)
ではURLについて触れ、  
[Chapter3](https://github.com/igadaruma/study-scala/blob/main/doc/chapter3/chapter3.md)
では各ステップ毎にそれぞれ別のURLをブラウザで参照いただきました。

Playを含め、Webフレームワークと呼ばれるものの多くは、言語問わず、  
`このURLに対しては、この処理(関数)を実行するよ。`といった設定が行えるようになっています。  
この手の設定のことをルーティング設定と呼んだりします。

### Playにおけるルーティング設定

Playでは`conf/routes`ファイルに対して設定を書いていきます。  
今回新たにcloneした、[study-scala-chapter4のroutesファイル](https://github.com/igadaruma/study-scala-chapter4/blob/main/conf/routes)
を見てみましょう。  
以下のような記載があると思います。

```
# URLに対する処理(関数(メソッド))の割当を行っている設定ファイルです。
GET        /        controllers.SampleController.index()
```

1行目の`#`で始まる行はコメントで、設定には影響を及ぼしません。  
2行目が設定例になっています。  
1行毎に1つのURLに対する設定を記載していく形となりますが、  
3つのセクションに分かれていまして、ざっくりとは、

```
HTTPリクエストメソッド    URLのパス部分    パッケージ名.クラス名.メソッド名
```

といった書式になっています。

### HTTPリクエストメソッド

`HTTPリクエストメソッド`という謎ワードが登場しました🤔  
ここに入る代表的に値には`GET`, `POST`, `PUT`, `PATCH`, `DELETE`といったようなものがあります。

ブラウザがサーバーに対して`データくださいな。`とリクエスト通信を行う際には、  
住所的な位置づけのURLの他にも、色々な追加の情報・データが存在します。  
例えば、Chapter1では、フォームに入力した情報(足し算する値)をサーバーに送っていました。  
このような追加情報の1つにHTTPリクエストメソッドがあります。  
(※筆者は略してHTTPメソッドと呼ぶことが多いです。)

HTTPリクエストメソッドの先の具体例は、   
慣習上おおよそ以下のような用途で使いわけられます。

|  メソッド  | 用途 | 
| ---- | ---- |
| GET | データください。 |
| POST | データ送ります。 or データ送るので新規データとして保存してください。 |
| PUT | データ送るので既存データを上書き保存してください。<br>※送るのは、対象データ一式。 |
| PATCH | データ送るので既存データを上書き保存してください。<br>※送るのは、対象データの変更箇所(差分)のみ。 |
| DELETE | データ消してください。 |

しかしながら、ブラウザがリクエストでいずれのHTTPメソッドを指定したとしても、  
実際にサーバーにこれらの用途に合う動作を強制させる力は無いので、  
あくまでも何が行われるかは、サーバー側の実装次第です。  
ただ、慣習に従ってアプリを実装しておくのを私はおすすめしています。

例えば、誰かが作ったPlayアプリケーションを私が解析する立場になったとします。  
手始めに`routes`ファイルを覗いてみたところ、以下の記述があったとします。  
(※まだ解説してない記法`(:id)部分等`がありますが今は雰囲気だけを感じてみてください・・！)

```
GET        /books        controllers.BookController.getAll()
POST       /books        controllers.BookController.create()
PUT        /books/:id    controllers.BookController.update(id)
DELETE     /books/:id    controllers.BookController.delete(id)
```

この場合、私ならば・・・  
「これはきっと`本`のデータを扱っているWebアプリで、   
1行目(GET): 本データを全部取得できるURL  
2行目(POST): 本データを追加できるURL  
3行目(PUT): 本データを更新できるURL  
4行目(DELETE): 本データを削除できるURL  
という感じなんだろう！きっとそーだ！」  
と、予想を立てます。  
そして、その予想の胸に、各メソッドを読み解いていくことになるわけですが、  
もし予想が外れていたら、あれあれ？なんか違うな？と混乱しながら読むことになりますが、    
予想通りならば、よしよし。と読み進めていく感じになるわけです。    

もしもDELETEなのにデータ作成の処理なんてしていたら、  
〇〇〇〇？〇〇〇〇！(コンプライアンス違反のため伏字)   
と、なるわけです。

つまるところ、予想通りの実装になっていたほうが、  
心理的・認知的負荷が軽減されるのはずですので、  
一般的な慣習に習うというのことも大切だと考えているわけです。

一方、先のテーブルの用途には分類しづらい機能を実装することも多々あります。  
そんな時は`GET`と`POST`から選ぶのが良いと思います。  
中でも`GET`を指定することを今は基本に考えてみて欲しいです。  
理由としては、ブラウザは特別に指定が無い限りは`GET`メソッドを指定して、  
サーバーにリクエストする仕様になっているためです。  

ちなみにもう一つの`POST`は、  
以下のようなHTMLのformタグのmethod属性に`post`が指定されていて、
```
<form method="post">
省略
</form>
```
このフォームが送信処理された(`<input type="submit" value="送信" />`押された)時等に指定されます。

その他のメソッドは、まだ紹介できてない、  
HTMLの友達である、javascriptというプログラミング言語を使い、  
Ajaxと呼ばれる方法でリクエストする場合等に指定ができるものなのですが、  
今説明するには、話が長くなりすぎるため一旦忘れてしまってください😌  
詳しくはいつか取り上げたいと考えています。ごめんね🥺

TODO
